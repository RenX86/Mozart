<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mozart Dashboard</title>
    <!-- Google Fonts: Space Grotesk -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 (for grid system mainly) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- HTMX for smart polling -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body>
    <nav class="navbar mb-5">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-music me-2"></i> MOZART_DASH
            </a>
            <div class="d-flex align-items-center gap-3">
                <div class="status-indicator">
                    {% if bot_name %}
                    <span class="badge-brutal badge-online">ONLINE</span>
                    {% else %}
                    <span class="badge-brutal badge-offline">OFFLINE</span>
                    {% endif %}
                </div>

                {% if user %}
                <div class="user-badge d-flex align-items-center gap-2">
                    {% if user.avatar %}
                    <img src="https://cdn.discordapp.com/avatars/{{ user.id }}/{{ user.avatar }}.png" alt="Avatar"
                        class="rounded-circle" width="32" height="32">
                    {% endif %}
                    <span class="fw-bold">{{ user.username }}</span>
                    <a href="{{ url_for('logout') }}" class="btn-brutal btn-sm">LOGOUT</a>
                </div>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn-brutal btn-sm">LOGIN_DISCORD</a>
                {% endif %}

                <button id="themeToggle" class="btn-brutal btn-icon" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container with HTMX Polling -->
    <div class="container" id="dashboard-content" hx-get="{{ url_for('dashboard_partial') }}" hx-trigger="every 5s"
        hx-swap="innerHTML">
        {% include 'partials/dashboard_body.html' %}
    </div>

    <script>
        // Theme Toggling Logic
        const themeToggleBtn = document.getElementById('themeToggle');
        const themeIcon = themeToggleBtn.querySelector('i');

        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateIcon(savedTheme);

        themeToggleBtn.addEventListener('click', () => {
            let currentTheme = document.documentElement.getAttribute('data-theme');
            let newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
        });

        function updateIcon(theme) {
            if (theme === 'dark') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }
    </script>
</body>

</html>